@model MojCRM.Areas.HelpDesk.ViewModels.DeliveryDetailsViewModel
@using System.Web.UI.WebControls
@using MojCRM.Helpers

@{
    ViewBag.Title = "Detalji";
    Layout = "~/Views/Shared/_UserLayoutNew.cshtml";
}

@{ 
    var deliveryAgents = new List<ListItem>
    {
        new ListItem{ Value = "Darko Glatki", Text = "Darko Glatki"},
        new ListItem{ Value = "Filip Troskot", Text = "Filip Troskot"},
        new ListItem{ Value = "Filip Karmazen", Text = "Filip Karmazen"},
        new ListItem{ Value = "Katarina Ceković", Text = "Katarina Ceković"},
        new ListItem{ Value = "Viktor Jajtić", Text = "Viktor Jajtić"},
        new ListItem{ Value = "Filip Vučemilović Grgić", Text = "Filip Vučemilović Grgić"},
        new ListItem{ Value = "Nikolina Ćosić", Text = "Nikolina Ćosić"},
        new ListItem{ Value = "Ivan Boban", Text = "Ivan Boban"},
        new ListItem{ Value = "Ana Šimac", Text = "Ana Šimac"},
        new ListItem{ Value = "Matija Ekart", Text = "Matija Ekart"},
        new ListItem{ Value = "Filip Klarić", Text = "Filip Klarić"}
    };
}

<!--Modal - CreateContact-->
@using (Html.BeginForm("CreateFromDelivery", "Contact", new { area = ""}, FormMethod.Post))
{
    <div class="modal fade" id="CreateContact" tabindex="-1" role="dialog" aria-labelledby="CreateContact">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Kreiraj kontakt za dostavu</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="delivery-contact-first-name">@Html.DisplayNameFor(model => model.DeliveryContactFirstName)</label>
                                <div id="delivery-contact-first-name">
                                    @Html.TextBox("FirstName", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Ime kontakta" })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-last-name">@Html.DisplayNameFor(model => model.DeliveryContactLastName)</label>
                                <div id="delivery-contact-last-name">
                                    @Html.TextBox("LastName", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Prezime kontakta" })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-telephone">@Html.DisplayNameFor(model => model.DeliveryContactTelephone)</label>
                                <div id="delivery-contact-telephone">
                                    @Html.TextBox("Telephone", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Broj telefona kontakta" })
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4">
                                <label for="delivery-contact-mobile">@Html.DisplayNameFor(model => model.DeliveryContactMobileTelephone)</label>
                                <div id="delivery-contact-mobile">
                                    @Html.TextBox("Mobile", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Broj mobitela kontakta" })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-email">@Html.DisplayNameFor(model => model.DeliveryEmailAddress)</label>
                                <div id="delivery-contact-email">
                                    @Html.TextBox("Email", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "E-mail adresa kontakta" })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-title">Titula / Funkcija</label>
                                <div id="delivery-contact-title">
                                    @Html.TextBox("TitleFunction", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Titula / Funkcija" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-contact-receiver">
                                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-contact-documentid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.TicketId })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Kreiraj kontakt</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

<!--Modal - EditContact-->
@using (Html.BeginForm("EditFromDelivery", "Contact", new { area = "" }, FormMethod.Post))
{
    <div class="modal fade" id="EditContact" tabindex="-1" role="dialog" aria-labelledby="EditContact">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Uredi kontakt za dostavu</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="delivery-detail-contact">Kontakt osoba</label>
                            <div id="delivery-detail-contact">
                                @Html.DropDownList("ContactId", Model.RelatedDeliveryContactsForDetails, new { @class = "form-control" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="delivery-contact-first-name">@Html.DisplayNameFor(model => model.DeliveryContactFirstName)</label>
                                <div id="delivery-contact-first-name">
                                    @Html.TextBox("FirstName", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.DeliveryContactFirstName })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-last-name">@Html.DisplayNameFor(model => model.DeliveryContactLastName)</label>
                                <div id="delivery-contact-last-name">
                                    @Html.TextBox("LastName", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.DeliveryContactLastName })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-telephone">@Html.DisplayNameFor(model => model.DeliveryContactTelephone)</label>
                                <div id="delivery-contact-telephone">
                                    @Html.TextBox("Telephone", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.DeliveryContactTelephone })
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-4">
                                <label for="delivery-contact-mobile">@Html.DisplayNameFor(model => model.DeliveryContactMobileTelephone)</label>
                                <div id="delivery-contact-mobile">
                                    @Html.TextBox("Mobile", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.DeliveryContactMobileTelephone })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-email">@Html.DisplayNameFor(model => model.DeliveryEmailAddress)</label>
                                <div id="delivery-contact-email">
                                    @Html.TextBox("Email", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = Model.DeliveryContactEmail })
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="delivery-contact-title">Titula / Funkcija</label>
                                <div id="delivery-contact-title">
                                    @Html.TextBox("TitleFunction", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Titula / Funkcija" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-contact-receiver">
                                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-contact-documentid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.TicketId })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Predaj izmjene</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

@{
    var deliveryTemplates = new List<ListItem>
        {
            new ListItem {Text = "Preuzet će", Value = "Preuzet će" },
            new ListItem {Text = "Promjena e-maila", Value = "Promjena e-maila" },
            new ListItem {Text = "Ponovno poslana obavijest o dostavi", Value = "Ponovno poslana obavijest o dostavi" },
            new ListItem {Text = "Nisu se javili", Value = "Nisu se javili" },
        };
}

<!--Modal - AddDetail-->
@using (Html.BeginForm("AddDetail", "Delivery", FormMethod.Post))
{
    <div class="modal fade" id="AddDetail" tabindex="-1" role="dialog" aria-labelledby="AddDetail">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Kreiraj napomenu dostave</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="hidden">
                                <div id="delivery-detail-receiver">
                                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                                </div>
                            </div>
                            @*<div class="col-md-12">
                                <label for="delivery-detail-user">@Html.DisplayNameFor(model => model.DeliveryDetailAgent)</label>
                                <div id="delivery-detail-user">
                                    @Html.TextBox("_Agent", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = @User.Identity.Name, @disabled = true })
                                </div>
                            </div>*@
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail-contact">Kontakt osoba</label>
                                <div id="delivery-detail-contact">
                                    @Html.DropDownList("Contact", Model.RelatedDeliveryContactsForDetails, new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail-template">Napomena</label>
                                <div id="delivery-detail-contact">
                                    @Html.DropDownList("DetailTemplate", new SelectList(deliveryTemplates, "Value", "Text"), "Odaberi napomenu",new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail">@Html.DisplayNameFor(model => model.DeliveryDetailDetail)</label>
                                <div id="delivery-detail">
                                    @Html.TextArea("DetailNote", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Napomena dostave" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-detail-ticketid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.TicketId })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-detail-identifier">
                                    @Html.TextBox("Identifier", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = 1 })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-detail-invoice-number">
                                    @Html.TextBox("InvoiceNumber", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = 1 })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Kreiraj napomenu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

<!--Modal - EditDetail-->
@using (Html.BeginForm("EditDetail", "Delivery", FormMethod.Post))
{
    <div class="modal fade" id="EditDetail" tabindex="-1" role="dialog" aria-labelledby="EditDetail">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Izmijeni napomenu dostave</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="hidden">
                                <div id="delivery-detail-receiver">
                                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                                </div>
                            </div>
                            @*<div class="col-md-12">
                                <label for="delivery-detail-user">@Html.DisplayNameFor(model => model.DeliveryDetailAgent)</label>
                                <div id="delivery-detail-user">
                                    @Html.TextBox("_Agent", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = @User.Identity.Name })
                                </div>
                            </div>*@
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail-contact">Kontakt osoba</label>
                                <div id="delivery-detail-contact">
                                    @Html.DropDownList("Contact", Model.RelatedDeliveryContactsForDetails, new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail-id">Odaberi staru napomenu za izmjenu</label>
                                <div id="delivery-detail-contact">
                                    @Html.DropDownList("DetailNoteId", Model.DeliveryDetailsIds, new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail">Nova napomena</label>
                                <div id="delivery-detail">
                                    @Html.TextArea("DetailNote", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Napomena dostave" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-detail-ticketid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.TicketId })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Izmijeni napomenu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

<!--Modal - ChangeEmail-->
@using (Html.BeginForm("ChangeEmail", "Delivery", FormMethod.Post))
{
    <div class="modal fade" id="ChangeEmail" tabindex="-1" role="dialog" aria-labelledby="ChangeEmail">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Izmijeni e-mail adresu za dostavu dokumenta</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="hidden">
                                <div id="delivery-detail-receiver">
                                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div id="delivery-email">
                                    <label for="delivery-email">@Html.DisplayNameFor(model => model.ReceiverEmail)</label>
                                    <div id="old-email">
                                        @Html.TextBox("OldEmail", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverEmail })
                                    </div>
                                </div>
                            </div>
                            <br />
                            <br />
                            <div class="col-md-12">
                                <div id="delivery-new-email">
                                    @Html.TextBox("NewEmail", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Nova e-mail adresa" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-detail-ticketid">
                                    @Html.TextBox("MerElectronicId", ViewBag.CurrentFilter as string, new { @Value = Model.MerElectronicId })
                                </div>
                                <div id="delivery-detail-ticketid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @Value = Model.TicketId })
                                </div>
                                <div id="delivery-invoice-number">
                                    @Html.TextBox("InvoiceNumber", ViewBag.CurrentFilter as string, new { @Value = Model.InvoiceNumber })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Izmijeni adresu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

<!--Modal - DeleteDetail-->
@using (Html.BeginForm("DeleteDetail", "Delivery", FormMethod.Post))
{
    @Html.AntiForgeryToken();
    <div class="modal fade" id="DeleteDetail" tabindex="-1" role="dialog" aria-labelledby="DeleteDetail">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content panel-danger" style="overflow:hidden">
                <div class="modal-header panel-danger">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Brisanje napomene dostave</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <p>Odabirom niže napomene, uklonit ćete napomenu iz sustava!</p>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="delivery-detail-id">Odaberi napomenu za brisanje</label>
                                <div id="delivery-detail-contact">
                                    @Html.DropDownList("DetailId", Model.DeliveryDetailsIds, new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="hidden">
                    <div id="ticket-id">
                        @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.TicketId })
                    </div>
                    <div id="receiver-id">
                        @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Izbriši napomenu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

<!--Modal - Reassign-->
@using (Html.BeginForm("Reassing", "Delivery", FormMethod.Post))
{
    <div class="modal fade" id="Reassing" tabindex="-1" role="dialog" aria-labelledby="Reassing">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Promijeni dodjelu</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                Kartica je trenutno dodijeljena. Možete ju ili otključati ili dodijeliti drugom agentu.
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-12">
                                <label for="unassign">Otključaj karticu</label>
                                <div id="unassign">
                                    @Html.CheckBox("Unassign", false, new { @class = "checked", @id = "checkbox" })
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-12">
                                <label for="reassign">Dodijeli karticu drugom agentu</label>
                                <div id="unassign">
                                    @Html.DropDownList("ReassignedTo", new SelectList(deliveryAgents, "Value", "Text"), "Dodijeljeno agentu", new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="ticketid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.TicketId })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Predaj promjenu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}
<!--Modal - Document History-->
<div class="modal fade" id="DocumentHistory" tabindex="-1" role="dialog" aria-labelledby="DocumentHistory">
    <div class="modal-dialog modal-lg" role="document" style="width: 800px">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Povijest razmjene eDokumenata putem servisa Moj-eRačun</h4>
                <h6>Pregled zadnjih 20 dokumenata</h6>
            </div>
            <div class="modal-body" style="">
                <table class="table" style="word-break:break-word;">
                    <tr>
                        <th>Tip dokumenta</th>
                        <th>Status dokumenta</th>
                        <th>Naziv pošiljatelja</th>
                        <th>E-mail adresa</th>
                        <th>Broj dokumenta</th>
                        <th>Datum slanja</th>
                        <th></th>
                    </tr>
                    @foreach (var Document in Model.DocumentHistory)
                    {
                        <tr>
                            <td class="hidden">@Document.Id</td>
                            <td style="width:10%;">@Document.DocumentTypeIdString</td>
                            @if (Document.DocumentStatusString == "Poslan")
	                        {
		                        <td style="width:10%;"><span class="label label-warning">@Html.Raw(Document.DocumentStatusString)</span></td>
	                        }
                            @if (Document.DocumentStatusString == "Dostavljen")
                            {
                                <td style="width:10%;"><span class="label label-success">@Html.Raw(Document.DocumentStatusString)</span></td>
                            }
                            @if (Document.DocumentStatusString == "Ispisan")
                            {
                                <td style="width:10%;"><span class="label label-info">@Html.Raw(Document.DocumentStatusString)</span></td>
                            }
                            @if (Document.DocumentStatusString == "Neuspješan")
                            {
                                <td style="width:10%;"><span class="label label-danger">@Html.Raw(Document.DocumentStatusString)</span></td>
                            }
                            <td style="width:25%;">@Document.PosiljateljNaziv</td>
                            <td style="width:20%;">@Document.EmailPrimatelja</td>
                            <td style="width:15%;">@Document.InterniBroj</td>
                            @if (Document.DatumOtpreme != null)
                            {
                                <td style="width:15%;">@Document.DatumOtpreme</td>
                            }
                            @if (Document.DatumOtpreme != null)
                            {
                                <td style="width:5%;">
                                    <div class="btn-group" style="display:inline-grid;" role="group">
                                        <a href="@Url.RouteUrl(new { action = "Resend", controller = "Delivery", area = "HelpDesk", Model.TicketId, MerElectronicId = Document.Id, Model.ReceiverId, User.Identity.Name, IsTicket = false, returnUrl = Request.Url })" class="btn btn-sm btn-primary" title="Ponovno slanje obavijesti o dostavi eRačuna"><i class="glyphicon glyphicon-share-alt"></i></a>
                                        <a id="changeEmailNoTicket" method="post" title="Izmijeni e-mail adresu primatelja" class="btn btn-sm btn-primary" data-mer-id="@Document.Id" style="margin:0px;" data-old-email="@Document.EmailPrimatelja" data-ticket-id="@Html.Raw(Model.TicketId)" data-receiver-id="@Html.Raw(Model.ReceiverId)" data-invoice-number="@Document.InterniBroj" onclick="javascript: ChangeEmailNoTicket()" data-dismiss="modal" data-toggle="modal" href="#ChangeEmailNoTicket"><i class="glyphicon glyphicon-envelope"></i></a>
                                    </div>
                                </td>
                            }
                        </tr>
                    }
                </table>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - Related Activities-->
<div class="modal fade" id="RelatedActivities" tabindex="-1" role="dialog" aria-labelledby="RelatedActivities">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Povijest aktivnosti agenata vezanih za ovu karticu</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <th>Tip aktivnosti</th>
                        <th>Opis aktivnosti</th>
                        <th>Agent</th>
                        <th>Datum aktivnosti</th>
                    </tr>
                    @foreach (var Activity in Model.RelatedActivities)
                                {
                        <tr>
                            <td>@Activity.ActivityTypeString</td>
                            <td>@Activity.Description</td>
                            <td>@Activity.User</td>
                            <td>@Activity.InsertDate</td>
                        </tr>
                    }
                </table>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - Delivery Details-->
<div class="modal fade" id="DeliveryDetails" tabindex="-1" role="dialog" aria-labelledby="DeliveryDetails">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <div class="btn-group" role="group">
                    <button type="button" title="Kreiranje napomene dostave" class="btn btn-default btn-sm" data-toggle="modal" href="#AddDetail" data-dismiss="modal"><i class="fa fa-plus"></i></button>
                    @if (Model.RelatedDeliveryDetails.Count() != 0)
                    {
                        <a href="#DeleteDetail" title="Brisanje napomene dostave" class="btn btn-default btn-sm" data-toggle="modal" data-dismiss="modal"><i class="fa fa-trash"></i></a>
                    }
                </div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Napomene o dostavi eDokumenta</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.DeliveryDetailDateTime)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryDetailAgent)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryDetailDetail)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryDetailContact)</th>
                        <th></th>
                    </tr>
                    @foreach (var Detail in Model.RelatedDeliveryDetails)
                                {
                        <tr>
                            <td>@Detail.InsertDate</td>
                            <td>@Detail.User</td>
                            <td>@Detail.DetailNote</td>
                            <td>@Detail.Contact</td>
                            <td>
                                <a href="#EditDetail" data-toggle="modal" data-dismiss="modal"><i class="fa fa-edit"></i></a>
                            </td>
                        </tr>
                    }
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - Delivery Contacts-->
<div class="modal fade" id="DeliveryContacts" tabindex="-1" role="dialog" aria-labelledby="DeliveryContacts">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <button type="button" title="Kreiranje kontakta" class="btn btn-default btn-sm" data-toggle="modal" href="#CreateContact" data-dismiss="modal"><i class="fa fa-plus"></i></button>
                @if (Model.RelatedDeliveryContacts.Count() != 0)
                {
                    <a role="button" data-toggle="modal" href="#EditContact" class="btn btn-sm btn-default" title="Izmjena kontakta za dostavu" data-dismiss="modal"><i class="fa fa-pencil"></i></a>
                }
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Kontakti za dostavu eRačuna</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.DeliveryContactFirstName)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryContactLastName)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryContactTelephone)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryEmailAddress)</th>
                        <th>@Html.DisplayNameFor(model => model.DeliveryContactAgent)</th>
                        <th></th>
                    </tr>
                    @foreach (var Contact in Model.RelatedDeliveryContacts)
                            {
                        <tr>
                            <td style="width:15%;">@Contact.ContactFirstName</td>
                            <td style="width:15%;">@Contact.ContactLastName</td>
                            <td style="width:15%;">@Contact.TelephoneNumber;  @Contact.MobilePhoneNumber</td>
                            <td style="width:35%;"><a data-email="@Contact.Email" data-ticket-id="@Html.Raw(Model.TicketId)" name="contact-email" class="delivery-mail" href="mailto:@Contact.Email">@Contact.Email</a></td>
                            <td style="width:15%;">@Contact.User</td>
                            <td style="width:55%;">
                                <a href="#AddDetail" data-toggle="modal" data-dismiss="modal"><i style="color: forestgreen" class="fa fa-phone-square"></i></a>
                                <a data-dismiss="modal" data-receiver-id="@Html.Raw(Model.ReceiverId)" data-contact="@Html.Raw(Contact.ContactId)" data-detail-template="Informativni poziv" data-detail-note="" data-ticket-id="@Model.TicketId" data-invoice-number="@Model.InvoiceNumber" data-identifier-short="2" href="#" class="add-successfull-call-short"><i style="color: lightgreen" class="fa fa-phone-square"></i></a>
                                <a data-dismiss="modal" data-receiver-id="@Html.Raw(Model.ReceiverId)" data-contact="@Html.Raw(Contact.ContactId)" data-detail-template="Nisu se javili" data-detail-note="" data-ticket-id="@Model.TicketId" data-invoice-number="@Model.InvoiceNumber" data-identifier="3" href="#" class="add-unsuccessfull-call"><i style="color: gold" class="fa fa-phone-square"></i></a>
                            </td>
                        </tr>
                    }
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - Opened Tickets-->
<div class="modal fade" id="OpenTickets" tabindex="-1" role="dialog" aria-labelledby="OpenTickets">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Ostale otvorene kartice</h4>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.SenderName)</th>
                        <th>@Html.DisplayNameFor(model => model.MerDocumentTypeIdString)</th>
                        <th>@Html.DisplayNameFor(model => model.ReceiverEmail)</th>
                        <th>@Html.DisplayNameFor(model => model.InvoiceNumber)</th>
                        <th>@Html.DisplayNameFor(model => model.SentDate)</th>
                        <th></th>
                    </tr>
                    @foreach (var Invoice in Model.RelatedInvoices)
                            {
                        <tr>
                            <td>@Invoice.Sender.SubjectName</td>
                            <td>@Invoice.MerDocumentTypeIdString<br /><span class="label label-info">@Model.DocumentStatusString</span></td>
                            <td>@Invoice.BuyerEmail</td>
                            <td>@Invoice.InvoiceNumber</td>
                            <td>@Invoice.SentDate.ToShortDateString()</td>
                            <td>
                                <a href="@Url.RouteUrl(new { action = "Details", controller = "Delivery", area = "HelpDesk", Invoice.Id, Invoice.ReceiverId, User.Identity.Name, returnUrl = Request.Url })"><i class="fa fa-edit"></i></a>
                                <a href="@Url.RouteUrl(new { action = "UpdateStatusIndex", controller = "Delivery", area = "HelpDesk", Invoice.MerElectronicId, returnUrl = Request.Url })"><i style="color: forestgreen" class="fa fa-refresh"></i></a>
                                <a data-mer-id="@Html.Raw(Invoice.MerElectronicId)" href="#" class="remove-from-list-ajax"><i style="color: red" class="fa fa-remove"></i></a>
                            </td>
                        </tr>
                    }
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - Edit Important Comment-->
@using (Html.BeginForm("EditImportantComment", "Organizations", new { area = "" }, FormMethod.Post))
{
    <div class="modal fade" id="EditImportantComment" tabindex="-1" role="dialog" aria-labelledby="EditImportantComment">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Uredi napomenu za dostavu za ovog primatelja</h4>
                </div>
                <div class="modal-body">
                    <div>
                        @Html.TextArea("Comment", ViewBag.CurrentFilter as string, new { @class = "form-control" })
                    </div>
                </div>
                <div class="hidden">
                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = Model.ReceiverId })
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-default">Predaj izmjenu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
                </div>
            </div>
        </div>
    </div>
}

<!--Modal - Postmark Openings-->
<div class="modal fade" id="PostmarkOpenings" tabindex="-1" role="dialog" aria-labelledby="PostmarkOpenings">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Pregled otvaranja zadnjih 20 e-mail obavijesti na Postmarku</h4>
            </div>
            <div class="modal-body">
                <div class="row col-md-12">Ovaj je primatelj do sada ukupno otvorio <strong>@Model.PostmarkOpenings.TotalCount</strong> e-mailova!</div>
                <br />
                <table class="table">
                    <tr>
                        <th>E-mail klijent</th>
                        <th>Proizvođač e-mail klijenta</th>
                        <th>Operativni sustav</th>
                        <th>Proizvođač operativnog sustava</th>
                        <th>Platforma</th>
                        <th>Vrijeme čitanja (s)</th>
                        <th>E-mail primatelja</th>
                    </tr>
                    @foreach (var Opening in Model.PostmarkOpenings.Opens)
                            {
                        <tr>
                            <td>@Opening.Client.Name</td>
                            <td>@Opening.Client.Company</td>
                            <td>@Opening.OS.Name</td>
                            <td>@Opening.OS.Company</td>
                            <td>@Opening.Platform</td>
                            <td>@Opening.ReadSeconds</td>
                            <td>@Opening.Recipient</td>
                        </tr>
                    }
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - Postmark Bounces-->
<div class="modal fade" id="PostmarkBounces" tabindex="-1" role="dialog" aria-labelledby="PostmarkBounces">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="overflow:hidden">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>Pregled zadnjih 20 odbijanja slanja e-mail obavijesti na Postmarku</h4>
            </div>
            <br />
            <div class="modal-body">
                <div class="row col-md-12">Ukupan broj odbijanja <strong>@Model.PostmarkBounces.TotalCount</strong></div>
                <br />
                <table class="table">
                    <tr>
                        <th>Tip odbijanja</th>
                        <th>Opis odbijanja</th>
                        <th>Detalji odbijanja</th>
                        <th>E-mail adresa primatelja</th>
                        <th>Vrijeme odbijanja</th>
                        <th>Naslov e-maila</th>
                        <th></th>
                    </tr>
                    @foreach (var Bounce in Model.PostmarkBounces.Bounces)
                    {
                        <tr>
                            <td>@Bounce.Name</td>
                            <td>@Bounce.Description</td>
                            <td>@Bounce.Description</td>
                            <td>@Bounce.Email</td>
                            <td>@Bounce.BouncedAt</td>
                            <td>@Bounce.Subject</td>
                            @if (true)
                            {
                                <td><a id="activateBounce" method="put" title="Aktivacija e-mail adrese" class="btn btn-sm btn-warning" data-bounce-id="@Html.Raw(Bounce.ID)" data-ticket-id="@Html.Raw(Model.TicketId)" onclick="javascript: PostmarkActivateBounce()"><i class="fa fa-check"></i></a></td>
                            }
                        </tr>
                    }
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Isključi pregled</button>
            </div>
        </div>
    </div>
</div>

<!--Modal - ChangeEmailNoTicket-->
@using (Html.BeginForm("ChangeEmailNoTicket", "Delivery", FormMethod.Post))
{
    <div class="modal fade" id="ChangeEmailNoTicket" tabindex="-1" role="dialog" aria-labelledby="ChangeEmailNoTicket">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content" style="overflow:hidden">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4>Izmijeni e-mail adresu za dostavu dokumenta</h4>
                </div>
                <div class="modal-body changeEmail">
                    <div class="form-group">
                        <div class="row hidden">
                            <div>
                                <div id="delivery-detail-receiver">
                                    @Html.TextBox("ReceiverId", ViewBag.CurrentFilter as string, new { @class = "form-control", @id = "_Receiver", @Value = Model.ReceiverId })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div id="delivery-email">
                                    <label for="old-email">E-mail adresa primatelja:</label>
                                    <div id="old-email">
                                        @Html.TextBox("OldEmail", ViewBag.CurrentFilter as string, new { @class = "form-control", @Value = "", @id = "delivery-email"/*, 
                                       @disabled = "disabled"*/ })
                                    </div>
                                </div>
                            </div>
                            <br />
                            <br />
                            <div class="col-md-12">
                                <div id="delivery-new-email">
                                    @Html.TextBox("NewEmail", ViewBag.CurrentFilter as string, new { @class = "form-control", @placeholder = "Nova e-mail adresa" })
                                </div>
                            </div>
                            <div class="hidden">
                                <div id="delivery-detail-ticketid">
                                    @Html.TextBox("MerElectronicId", ViewBag.CurrentFilter as string, new { @class = "form-control", @id = "_Id", @Value = "" })
                                </div>
                                <div id="delivery-detail-ticketid">
                                    @Html.TextBox("TicketId", ViewBag.CurrentFilter as string, new { @class = "form-control", @id = "_TicketId", @Value = "" })
                                </div>
                                <div id="invoice-number">
                                    @Html.TextBox("InvoiceNumber", ViewBag.CurrentFilter as string, new { @class = "form-control", @id = "InvoiceNumber", @Value = "" })
                                </div> 
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Izmijeni adresu</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Prekini</button>
                </div>
            </div>
        </div>
    </div>
}

<h2 style="text-align:center"><strong>Detalji za preuzimanje dokumenta: @Html.DisplayFor(model => model.MerDocumentTypeIdString) @Model.InvoiceNumber (@Model.DocumentStatusString)</strong></h2>
<br />
@if (Model.IsAssigned == true)
{
    <h4 style="text-align:center; color:red">Ova kartica je dodijeljena agentu: <strong>@Model.AssignedTo</strong></h4>
}
<div>
    <div class="row" style="text-align:center">
        <div class="col-md-12">
            <div class="btn-group" role="group">
                <a href="@Url.RouteUrl(new { action = "UpdateStatusDetails", controller = "Delivery", area = "HelpDesk", Model.TicketId, Model.ReceiverId, returnUrl = Request.Url })" class="btn btn-sm btn-primary" title="Osvježavanje statusa dokumenta - @Model.MerDocumentTypeIdString - @Model.InvoiceNumber"><i class="glyphicon glyphicon-refresh"></i> @*Osvježi status*@</a>
                <a href="@Url.RouteUrl(new { action = "Resend", controller = "Delivery", area = "HelpDesk", Model.TicketId, Model.MerElectronicId, Model.ReceiverId, returnUrl = Request.Url })" class="btn btn-sm btn-primary" title="Ponovno slanje obavijesti o dostavi eRačuna"><i class="glyphicon glyphicon-share-alt"></i> @*Ponovi slanje*@</a>
                <button type="button" title="Promjena e-mail adrese za dostavu eRačuna" class="btn btn-primary btn-sm" data-toggle="modal" href="#ChangeEmail"><i class="glyphicon glyphicon-envelope"></i></button>
                <button type="button" title="Pregled povijesti razmjene eDokumenata putem servisa Moj-eRačun" class="btn btn-primary btn-sm" data-toggle="modal" href="#DocumentHistory"><i class="fa fa-history"></i></button>
            </div>
            <div class="btn-group" role="group">
                <button type="button" title="Pregled povijesti otvaranja e-mailova s Postmarka" class="btn btn-sm btn-warning" data-toggle="modal" href="#PostmarkOpenings"><i class="fa fa-envelope-open-o"></i></button>
                <button type="button" title="Pregled povijesti odbijanja e-mailova s Postmarka" class="btn btn-sm btn-warning" data-toggle="modal" href="#PostmarkBounces"><i class="fa fa-warning"></i></button>
            </div>
            <div class="btn-group" role="group">
                <button type="button" title="Pregled aktivnosti vezanih uz ovaj dokument" class="btn btn-sm btn-default" data-toggle="modal" href="#RelatedActivities"><i class="fa fa-history"></i></button>
                <button type="button" title="Pregled napomena dostave vezanih uz ovaj dokument" class="btn btn-sm btn-default" data-toggle="modal" href="#DeliveryDetails"><i class="fa fa-sticky-note"></i></button>
                <button type="button" title="Pregled kontakata za dostavu" class="btn btn-sm btn-default" data-toggle="modal" href="#DeliveryContacts"><i class="fa fa-address-book"></i></button>
                <button type="button" title="Pregled ostalih otvorenih kartica" class="btn btn-sm btn-default" data-toggle="modal" href="#OpenTickets"><i class="fa fa-ticket"></i></button>
                @if (Model.IsAssigned == false)
                {
                    <a id="assign" method="post" title="Dodijeli karticu" class="btn btn-sm btn-default" data-ticket-id="@Html.Raw(Model.TicketId)" data-agent="@User.Identity.Name" onclick="javascript: Assign()"><i class="fa fa-check-circle-o"></i></a>
                }
                @if (Model.IsAssigned == true && (User.IsInRole("Management") || User.IsInRole ("Administrator") || User.IsInRole("Superadmin")))
                {
                    <button type="button" title="Promijeni dodjelu" class="btn btn-sm btn-default" data-toggle="modal" data-target="#Reassing" href="#Reassing"><i class="fa fa-mail-reply-all"></i></button>
                }
                <a href="@Url.RouteUrl(new { action = "Index", controller = "Delivery", area = "HelpDesk", returnUrl = Request.Url})" class="btn btn-sm btn-default" title="Povratak na inicijalni popis kartica"><i class="glyphicon glyphicon-arrow-left"></i></a>
            </div>
        </div>
    </div>
</div>
<hr />

<div>
    <div class="row">
        <div class="col-md-4">
            <strong>@Html.DisplayNameFor(model => model.SenderName)</strong>
            @Model.SenderName (@Model.SenderVAT)
        </div>
        <div class="col-md-4">
            <strong>@Html.DisplayNameFor(model => model.ReceiverName)</strong>
            <a href="@Url.RouteUrl(new { action = "Details", controller = "Organizations", area = "", Id = Model.ReceiverId })">@Model.ReceiverName (@Model.ReceiverVAT)</a>
        </div>
        <div class="col-md-4">
            <strong>@Html.DisplayNameFor(model => model.ReceiverEmail)</strong>
            @Html.DisplayFor(model => model.ReceiverEmail)
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-4">
            <strong>@Html.DisplayNameFor(model => model.MerDocumentTypeIdString)</strong>
            @Model.MerDocumentTypeIdString
        </div>
        <div class="col-md-4">
            <strong>@Html.DisplayNameFor(model => model.InvoiceNumber)</strong>
            @Html.DisplayFor(model => model.InvoiceNumber)
        </div>
        <div class="col-md-4">
            <strong>@Html.DisplayNameFor(model => model.SentDate)</strong>
            @Html.DisplayFor(model => model.SentDate)
        </div>
    </div>
    <br />
    <br />
    <div class="row">
        <div class="col-md-10">
            <strong>@Html.DisplayNameFor(model => model.ImportantComment)</strong>
            @Model.ImportantComment
        </div>
        <div class="col-md-2">
            <button type="button" data-toggle="modal" href="#EditImportantComment" data-target="#EditImportantComment" title="Uredi napomenu za dostavu za ovog primatelja" class="btn btn-default btn-sm"><i class="fa fa-pencil"></i></button>
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-md-12">
            <strong>@Html.DisplayNameFor(model => model.LastDeliveryDetail)</strong>
            @Model.LastDeliveryDetail
        </div>
    </div>
    <hr />
    <h4><img src="~/Content/e_racun_logo_source.png" style="width:100px; height:30px" /></h4>
    <div class="row">
        <div class="col-md-6">
            <strong>@Html.DisplayNameFor(model => model.MerDeliveryDetailComment)</strong>
            @Html.DisplayFor(model => model.MerDeliveryDetailComment)
        </div>
        <div class="col-md-6">
            <strong>@Html.DisplayNameFor(model => model.MerDeliveryDetailTelephone)</strong>
            @Html.DisplayFor(model => model.MerDeliveryDetailTelephone)
        </div>
    </div>
</div>
<hr />
<script>
    $(document).on("click", "a.remove-from-list-ajax", function (e) {
        e.preventDefault();
        if (window.confirm("Jeste li sigurni da želite ukloniti ovaj račun iz popisa za dostavu?"))
            $.ajax({
                method: 'POST',
                url: '@Url.RouteUrl(new { action = "Remove", controller = "Delivery", area = "HelpDesk" })',
                data: {
                    MerElectronicId: $(this).data("mer-id")
                },
                success: function (data) {
                    if (data.Status === 'OK')
                        alert("Uspješno ste uklonili račun iz popisa za dostavu!");
                    else
                        alert("Greška!");
                },
                dataType: 'json'
            });
        window.location.reload(true)
    });
    $(document).on("click", "a.add-successfull-call-short", function (e) {
        e.preventDefault();
        $.ajax({
            method: 'POST',
            url: '@Url.RouteUrl(new { action = "AddDetail", controller = "Delivery", area = "HelpDesk" })',
            data: {
                ReceiverId: $(this).data("receiver-id"),
                Contact: $(this).data("contact"),
                DetailTemplate: $(this).data("detail-template"),
                DetailNote: $(this).data("detail-note"),
                TicketId: $(this).data("ticket-id"),
                InvoiceNumber: $(this).data("invoice-number"),
                Identifier: $(this).data("identifier-short")
            },
            success: function (data) {
                if (data.Status === 'OK')
                    alert("Uspješno ste zabilježili informativni poziv!");
            },
            dataType: 'json'
        });
        window.location.reload(true)
    });
        $(document).on("click", "a.add-unsuccessfull-call", function (e) {
        e.preventDefault();
        $.ajax({
            method: 'POST',
            url: '@Url.RouteUrl(new { action = "AddDetail", controller = "Delivery", area = "HelpDesk" })',
            data: {
                ReceiverId: $(this).data("receiver-id"),
                Contact: $(this).data("contact"),
                DetailTemplate: $(this).data("detail-template"),
                DetailNote: $(this).data("detail-note"),
                TicketId: $(this).data("ticket-id"),
                InvoiceNumber: $(this).data("invoice-number"),
                Identifier: $(this).data("identifier")
            },
            success: function (data) {
                if (data.Status === 'OK')
                    alert("Uspješno ste zabilježili neuspješan poziv!");
            },
            dataType: 'json'
        });
        window.location.reload(true)
    });
        $(document).on("click", "a.delivery-mail", function (e) {
        e.preventDefault();
        $.ajax({
            method: 'POST',
            url: '@Url.RouteUrl(new { action = "LogEmail", controller = "Delivery", area = "HelpDesk" })',
            data: {
                _Email: $(this).data("email"),
                _TicketId: $(this).data("ticket-id"),
            },
            dataType: 'json'
        });
        var email = $(this).data("email");
        var subject = "Upit";
        window.location = 'mailto:' + email + '?subject=' + subject;
        });
</script>
<script>
        function Assign() {
            $(document).on("click", "#assign", function (e) {
                e.preventDefault();
                if (window.confirm("Jeste li sigurni da želite dodijeliti ovu karticu sebi?"))
                    $.ajax({
                        method: 'POST',
                        url: '@Url.RouteUrl(new { action = "Assign", controller = "Delivery", area = "HelpDesk" })',
                        data: {
                            Id: $(this).data("ticket-id"),
                            Agent: $(this).data("agent")
                        },
                        success: function (data) {
                            if (data.Status === 'OK')
                                alert("Kartica Vam je dodijeljenja!");
                            else
                                alert("Greška!");
                        },
                        dataType: 'json'
                    });
                window.location.reload(true)
            });
        };
        function PostmarkActivateBounce() {
            $(document).on("click", "#activateBounce", function (e) {
                this.disabled = true;
                e.preventDefault();
                $.ajax({
                    method: 'POST',
                    url: '@Url.RouteUrl(new { action = "PostmarkActivateBounce", controller = "Delivery", area = "HelpDesk" })',
                    data: {
                        BounceId: $(this).data("bounce-id"),
                        TicketId: $(this).data("ticket-id")
                    },
                    success: function (data) {
                        if (data.Status === 'OK')
                            alert("Reaktivirali ste e-mail adresu!");
                        else
                            alert("Greška!");
                    },
                    dataType: 'json'
                });
                window.location.reload(true)
            });
        };

    function ChangeEmailNoTicket() {
        $(document).on("click", "#changeEmailNoTicket", function (e) {
                e.preventDefault();
                var MerElectronicId = $(this).data("mer-id");
                var ReceiverId = $(this).data("receiver-id");
                var OldEmail = $(this).data("old-email");
                var TicketId = $(this).data("ticket-id");
                var InvoiceNumber = $(this).data("invoice-number");
                $(".changeEmail #_Receiver").val(ReceiverId);
                $(".changeEmail #delivery-email").val(OldEmail);
                $(".changeEmail #_Id").val(MerElectronicId);
                $(".changeEmail #_TicketId").val(TicketId);
                $(".changeEmail #InvoiceNumber").val(InvoiceNumber);
            });
        };
</script>
