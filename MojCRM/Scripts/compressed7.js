!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.validation={})}(function(e,t){function r(e){var t="max"===e;return function(r,i){if(n.utils.isEmptyVal(r))return!0;var a,s;void 0===i.typeAttr?(s="text",a=i):(s=i.typeAttr,a=i.value),isNaN(a)||a instanceof Date||(s="number");var u,o,l;switch(s.toLowerCase()){case"week":if(u=/^(\d{4})-W(\d{2})$/,null===(o=r.match(u)))throw new Error("Invalid value for "+e+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min");return!!(l=a.match(u))&&(t?o[1]<l[1]||o[1]===l[1]&&o[2]<=l[2]:o[1]>l[1]||o[1]===l[1]&&o[2]>=l[2]);case"month":if(u=/^(\d{4})-(\d{2})$/,null===(o=r.match(u)))throw new Error("Invalid value for "+e+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min");return!!(l=a.match(u))&&(t?o[1]<l[1]||o[1]===l[1]&&o[2]<=l[2]:o[1]>l[1]||o[1]===l[1]&&o[2]>=l[2]);case"number":case"range":return t?!isNaN(r)&&parseFloat(r)<=parseFloat(a):!isNaN(r)&&parseFloat(r)>=parseFloat(a);default:return t?a>=r:r>=a}}}function i(e,t,r){return!!t.validator(e(),void 0===r.params||u(r.params))||(e.setError(n.formatMessage(r.message||t.message,u(r.params),e)),!1)}function a(e,t,r){e.isValidating(!0);var i=function(i){var a=!1,s="";return e.__valid__()?(i.message?(a=i.isValid,s=i.message):a=i,a||(e.error(n.formatMessage(s||r.message||t.message,u(r.params),e)),e.__valid__(a)),void e.isValidating(!1)):void e.isValidating(!1)};n.utils.async(function(){t.validator(e(),void 0===r.params||u(r.params),i)})}if(void 0===e)throw new Error("Knockout is required, please ensure it is loaded before loading this validation plug-in");e.validation=t;var n=e.validation,s=e.utils,u=s.unwrapObservable,o=s.arrayForEach,l=s.extend,d={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateInputElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:!1,grouping:{deep:!1,observable:!0,live:!1},validate:{}},f=l({},d);f.html5Attributes=["required","pattern","min","max","step"],f.html5InputTypes=["email","number","date"],f.reset=function(){l(f,d)},n.configuration=f,n.utils=function(){var e=(new Date).getTime(),t={},r="__ko_validation__";return{isArray:function(e){return e.isArray||"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return null!==e&&"object"==typeof e},isNumber:function(e){return!isNaN(e)},isObservableArray:function(e){return!!e&&"function"==typeof e.remove&&"function"==typeof e.removeAll&&"function"==typeof e.destroy&&"function"==typeof e.destroyAll&&"function"==typeof e.indexOf&&"function"==typeof e.replace},values:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t},getValue:function(e){return"function"==typeof e?e():e},hasAttribute:function(e,t){return null!==e.getAttribute(t)},getAttribute:function(e,t){return e.getAttribute(t)},setAttribute:function(e,t,r){return e.setAttribute(t,r)},isValidatable:function(e){return!!(e&&e.rules&&e.isValid&&e.isModified)},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},newId:function(){return e+=1},getConfigOptions:function(e){return n.utils.contextFor(e)||n.configuration},setDomData:function(e,i){var a=e[r];a||(e[r]=a=n.utils.newId()),t[a]=i},getDomData:function(e){var i=e[r];return i?t[i]:void 0},contextFor:function(e){switch(e.nodeType){case 1:case 8:var t=n.utils.getDomData(e);if(t)return t;if(e.parentNode)return n.utils.contextFor(e.parentNode)}},isEmptyVal:function(e){return void 0===e||(null===e||(""===e||void 0))},getOriginalElementTitle:function(e){var t=n.utils.getAttribute(e,"data-orig-title"),r=e.title;return n.utils.hasAttribute(e,"data-orig-title")?t:r},async:function(e){window.setImmediate?window.setImmediate(e):window.setTimeout(e,0)},forEach:function(e,t){if(n.utils.isArray(e))return o(e,t);for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)}}}();var c=function(){function t(e){o(e.subscriptions,function(e){e.dispose()}),e.subscriptions=[]}function r(e){e.options.deep&&(o(e.flagged,function(e){delete e.__kv_traversed}),e.flagged.length=0),e.options.live||t(e)}function i(e,i){i.validatables=[],t(i),a(e,i),r(i)}function a(t,r,i){var n=[],s=t.peek?t.peek():t;!0!==t.__kv_traversed&&(r.options.deep&&(t.__kv_traversed=!0,r.flagged.push(t)),i=void 0!==i?i:r.options.deep?1:-1,e.isObservable(t)&&(t.errors||p.isValidatable(t)||t.extend({validatable:!0}),r.validatables.push(t),r.options.live&&p.isObservableArray(t)&&r.subscriptions.push(t.subscribe(function(){r.graphMonitor.valueHasMutated()}))),s&&!s._destroy&&(p.isArray(s)?n=s:p.isObject(s)&&(n=p.values(s))),0!==i&&p.forEach(n,function(t){!t||t.nodeType||e.isComputed(t)&&!t.rules||a(t,r,i+1)}))}function d(e){var t=[];return o(e,function(e){p.isValidatable(e)&&!e.isValid()&&t.push(e.error.peek())}),t}var f=0,c=n.configuration,p=n.utils;return{init:function(e,t){f>0&&!t||(e=e||{},e.errorElementClass=e.errorElementClass||e.errorClass||c.errorElementClass,e.errorMessageClass=e.errorMessageClass||e.errorClass||c.errorMessageClass,l(c,e),c.registerExtenders&&n.registerExtenders(),f=1)},reset:n.configuration.reset,group:function(t,r){var a={options:r=l(l({},c.grouping),r),graphMonitor:e.observable(),flagged:[],subscriptions:[],validatables:[]},n=null;return n=r.observable?e.computed(function(){return a.graphMonitor(),i(t,a),d(a.validatables)}):function(){return i(t,a),d(a.validatables)},n.showAllMessages=function(e){void 0===e&&(e=!0),n.forEach(function(t){p.isValidatable(t)&&t.isModified(e)})},n.isAnyMessageShown=function(){return!!n.find(function(e){return p.isValidatable(e)&&!e.isValid()&&e.isModified()})},n.filter=function(e){return e=e||function(){return!0},n(),s.arrayFilter(a.validatables,e)},n.find=function(e){return e=e||function(){return!0},n(),s.arrayFirst(a.validatables,e)},n.forEach=function(e){e=e||function(){},n(),o(a.validatables,e)},n.map=function(e){return e=e||function(e){return e},n(),s.arrayMap(a.validatables,e)},n._updateState=function(e){if(!p.isObject(e))throw new Error("An object is required.");return t=e,r.observable?void a.graphMonitor.valueHasMutated():(i(e,a),d(a.validatables))},n},formatMessage:function(e,t,r){if(p.isObject(t)&&t.typeAttr&&(t=t.value),"function"==typeof e)return e(t,r);var i=u(t);return null==i&&(i=[]),p.isArray(i)||(i=[i]),e.replace(/{(\d+)}/gi,function(e,t){return void 0!==i[t]?i[t]:e})},addRule:function(e,t){return e.extend({validatable:!0}),!!s.arrayFirst(e.rules(),function(e){return e.rule&&e.rule===t.rule})||e.rules.push(t),e},addAnonymousRule:function(e,t){void 0===t.message&&(t.message="Error"),t.onlyIf&&(t.condition=t.onlyIf),n.addRule(e,t)},addExtender:function(t){e.extenders[t]=function(e,r){return r&&(r.message||r.onlyIf)?n.addRule(e,{rule:t,message:r.message,params:!!p.isEmptyVal(r.params)||r.params,condition:r.onlyIf}):n.addRule(e,{rule:t,params:r})}},registerExtenders:function(){if(c.registerExtenders)for(var t in n.rules)n.rules.hasOwnProperty(t)&&(e.extenders[t]||n.addExtender(t))},insertValidationMessage:function(e){var t=document.createElement("SPAN");return t.className=p.getConfigOptions(e).errorMessageClass,p.insertAfter(e,t),t},parseInputValidationAttributes:function(e,t){o(n.configuration.html5Attributes,function(r){if(p.hasAttribute(e,r)){var i=e.getAttribute(r)||!0;if("min"===r||"max"===r){var a=e.getAttribute("type");void 0!==a&&a||(a="text"),i={typeAttr:a,value:i}}n.addRule(t(),{rule:r,params:i})}});var r=e.getAttribute("type");o(n.configuration.html5InputTypes,function(e){e===r&&n.addRule(t(),{rule:"date"===e?"dateISO":e,params:!0})})},writeInputValidationAttributes:function(t,r){var i=r();if(i&&i.rules){var a=i.rules();o(n.configuration.html5Attributes,function(r){var i=s.arrayFirst(a,function(e){return e.rule&&e.rule.toLowerCase()===r.toLowerCase()});i&&e.computed({read:function(){var a=e.unwrap(i.params);"pattern"===i.rule&&a instanceof RegExp&&(a=a.source),t.setAttribute(r,a)},disposeWhenNodeIsRemoved:t})}),a=null}},makeBindingHandlerValidatable:function(t){var r=e.bindingHandlers[t].init;e.bindingHandlers[t].init=function(t,i,a,n,s){return r(t,i,a,n,s),e.bindingHandlers.validationCore.init(t,i,a,n,s)}},setRules:function(t,r){var i=function(t,r){if(t&&r)for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];if(t[a]){var o=t[a],l=u(o),d={},f={};for(var c in s)s.hasOwnProperty(c)&&(n.rules[c]?d[c]=s[c]:f[c]=s[c]);if(e.isObservable(o)&&o.extend(d),l&&p.isArray(l))for(var v=0;v<l.length;v++)i(l[v],f);else i(l,f)}}};i(t,r)}}}();l(e.validation,c),n.rules={},n.rules.required={validator:function(e,t){var r;return void 0===e||null===e?!t:(r=e,"string"==typeof e&&(r=String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")),!t||(r+"").length>0)},message:"This field is required."},n.rules.min={validator:r("min"),message:"Please enter a value greater than or equal to {0}."},n.rules.max={validator:r("max"),message:"Please enter a value less than or equal to {0}."},n.rules.minLength={validator:function(e,t){return!!n.utils.isEmptyVal(e)||(n.utils.isNumber(e)?""+e:e).length>=t},message:"Please enter at least {0} characters."},n.rules.maxLength={validator:function(e,t){return!!n.utils.isEmptyVal(e)||(n.utils.isNumber(e)?""+e:e).length<=t},message:"Please enter no more than {0} characters."},n.rules.pattern={validator:function(e,t){return n.utils.isEmptyVal(e)||null!==e.toString().match(t)},message:"Please check this value."},n.rules.step={validator:function(e,t){if(n.utils.isEmptyVal(e)||"any"===t)return!0;var r=100*e%(100*t);return Math.abs(r)<1e-5||Math.abs(1-r)<1e-5},message:"The value must increment by {0}."},n.rules.email={validator:function(e,t){return!t||(n.utils.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e))},message:"Please enter a proper email address."},n.rules.date={validator:function(e,t){return!t||(n.utils.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e)))},message:"Please enter a proper date."},n.rules.dateISO={validator:function(e,t){return!t||(n.utils.isEmptyVal(e)||t&&/^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(e))},message:"Please enter a proper date."},n.rules.number={validator:function(e,t){return!t||(n.utils.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e))},message:"Please enter a number."},n.rules.digit={validator:function(e,t){return!t||(n.utils.isEmptyVal(e)||t&&/^\d+$/.test(e))},message:"Please enter a digit."},n.rules.phoneUS={validator:function(e,t){return!t||(!!n.utils.isEmptyVal(e)||"string"==typeof e&&(e=e.replace(/\s+/g,""),t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)))},message:"Please specify a valid phone number."},n.rules.equal={validator:function(e,t){var r=t;return e===n.utils.getValue(r)},message:"Values must equal."},n.rules.notEqual={validator:function(e,t){var r=t;return e!==n.utils.getValue(r)},message:"Please choose another value."},n.rules.unique={validator:function(e,t){var r=n.utils.getValue(t.collection),i=n.utils.getValue(t.externalValue),a=0;return!e||!r||(s.arrayFilter(r,function(r){e===(t.valueAccessor?t.valueAccessor(r):r)&&a++}),(i?1:2)>a)},message:"Please make sure the value is unique."},n.registerExtenders(),e.bindingHandlers.validationCore={init:function(t,r){var i=n.utils.getConfigOptions(t),a=r();if(i.parseInputAttributes&&n.utils.async(function(){n.parseInputValidationAttributes(t,r)}),i.insertMessages&&n.utils.isValidatable(a)){var s=n.insertValidationMessage(t);i.messageTemplate?e.renderTemplate(i.messageTemplate,{field:a},null,s,"replaceNode"):e.applyBindingsToNode(s,{validationMessage:a})}i.writeInputAttributes&&n.utils.isValidatable(a)&&n.writeInputValidationAttributes(t,r),i.decorateInputElement&&n.utils.isValidatable(a)&&e.applyBindingsToNode(t,{validationElement:a})}},n.makeBindingHandlerValidatable("value"),n.makeBindingHandlerValidatable("checked"),e.bindingHandlers.textInput&&n.makeBindingHandlerValidatable("textInput"),n.makeBindingHandlerValidatable("selectedOptions"),e.bindingHandlers.validationMessage={update:function(t,r){var i=r(),a=n.utils.getConfigOptions(t),o=(u(i),!1),l=!1;if(null===i||void 0===i)throw new Error("Cannot bind validationMessage to undefined value. data-bind expression: "+t.getAttribute("data-bind"));o=i.isModified&&i.isModified(),l=i.isValid&&i.isValid();var d=null;(!a.messagesOnModified||o)&&(d=l?null:i.error);var f=!(a.messagesOnModified&&!o)&&!l,c="none"!==t.style.display;a.allowHtmlMessages?s.setHtml(t,d):e.bindingHandlers.text.update(t,function(){return d}),c&&!f?t.style.display="none":!c&&f&&(t.style.display="")}},e.bindingHandlers.validationElement={update:function(t,r,i){var a=r(),s=n.utils.getConfigOptions(t),o=(u(a),!1),l=!1;if(null===a||void 0===a)throw new Error("Cannot bind validationElement to undefined value. data-bind expression: "+t.getAttribute("data-bind"));o=a.isModified&&a.isModified(),l=a.isValid&&a.isValid();e.bindingHandlers.css.update(t,function(){var e={},t=!(s.decorateElementOnModified&&!o)&&!l;return e[s.errorElementClass]=t,e},i),s.errorsAsTitle&&e.bindingHandlers.attr.update(t,function(){var e=!s.errorsAsTitleOnModified||o,r=n.utils.getOriginalElementTitle(t);return e&&!l?{title:a.error,"data-orig-title":r}:!e||l?{title:r,"data-orig-title":null}:void 0})}},e.bindingHandlers.validationOptions={init:function(e,t){var r=u(t());if(r){var i=l({},n.configuration);l(i,r),n.utils.setDomData(e,i)}}},e.extenders.validation=function(e,t){return o(n.utils.isArray(t)?t:[t],function(t){n.addAnonymousRule(e,t)}),e},e.extenders.validatable=function(t,r){if(n.utils.isObject(r)||(r={enable:r}),"enable"in r||(r.enable=!0),r.enable&&!n.utils.isValidatable(t)){var i=n.configuration.validate||{},a={throttleEvaluation:r.throttle||i.throttle};t.error=e.observable(null),t.rules=e.observableArray(),t.isValidating=e.observable(!1),t.__valid__=e.observable(!0),t.isModified=e.observable(!1),t.isValid=e.computed(t.__valid__),t.setError=function(e){var r=t.error.peek(),i=t.__valid__.peek();t.error(e),t.__valid__(!1),r===e||i||t.isValid.notifySubscribers()},t.clearError=function(){return t.error(null),t.__valid__(!0),t};var s=t.subscribe(function(){t.isModified(!0)}),u=e.computed(l({read:function(){return t(),t.rules(),n.validateObservable(t),!0}},a));l(u,a),t._disposeValidation=function(){t.isValid.dispose(),t.rules.removeAll(),s.dispose(),u.dispose(),delete t.rules,delete t.error,delete t.isValid,delete t.isValidating,delete t.__valid__,delete t.isModified,delete t.setError,delete t.clearError,delete t._disposeValidation}}else!1===r.enable&&t._disposeValidation&&t._disposeValidation();return t},n.validateObservable=function(e){for(var t,r,s=0,u=e.rules(),o=u.length;o>s;s++)if(!(r=u[s]).condition||r.condition())if((t=r.rule?n.rules[r.rule]:r).async||r.async)a(e,t,r);else if(!i(e,t,r))return!1;return e.clearError(),!0};var p,v={};n.defineLocale=function(e,t){return e&&t?(v[e.toLowerCase()]=t,t):null},n.locale=function(e){if(e){if(e=e.toLowerCase(),!v.hasOwnProperty(e))throw new Error("Localization "+e+" has not been loaded.");n.localize(v[e]),p=e}return p},n.localize=function(e){var t=n.rules;for(var r in e)t.hasOwnProperty(r)&&(t[r].message=e[r])},function(){var e={},t=n.rules;for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r].message);n.defineLocale("en-us",e)}(),p="en-us",e.applyBindingsWithValidation=function(t,r,i){var a,s=document.body;r&&r.nodeType?(s=r,a=i):a=r,n.init(),a&&(a=l(l({},n.configuration),a),n.utils.setDomData(s,a)),e.applyBindings(t,s)};var g=e.applyBindings;e.applyBindings=function(e,t){n.init(),g(e,t)},e.validatedObservable=function(t,r){if(!r&&!n.utils.isObject(t))return e.observable(t).extend({validatable:!0});var i=e.observable(t);return i.errors=n.group(n.utils.isObject(t)?t:{},r),i.isValid=e.observable(0===i.errors().length),e.isObservable(i.errors)?i.errors.subscribe(function(e){i.isValid(0===e.length)}):e.computed(i.errors).subscribe(function(e){i.isValid(0===e.length)}),i.subscribe(function(e){n.utils.isObject(e)||(e={}),i.errors._updateState(e),i.isValid(0===i.errors().length)}),i}});